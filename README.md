![image](https://github.com/patternizer/glosat-breakpoint-analysis/blob/main/037401-cusum-curve-linear-tree-loop.png)
![image](https://github.com/patternizer/glosat-breakpoint-analysis/blob/main/103810-cusum-curve-linear-tree-loop.png)
![image](https://github.com/patternizer/glosat-breakpoint-analysis/blob/main/685880-cusum-curve-linear-tree-loop.png)

# glosat-breakpoint-analysis

Python algorithm to calculate breakpoints in local expectation Kriging output CUSUM timeseries using linear tree regression and slope change detection. Part of ongoing work on land surface air temperature station homogensiation as part of the project [Glosat](www.glosat.org) 

## Contents

* `linear_tree_regression.py` - changepoint detection code to calculate breakpoints in the LEK CUSUM timeseries using linear tree regression (LTR) built using the linear tree regression driver by [Marco Cerliani](https://github.com/cerlymarco/linear-tree)
* `cru_changepoint_detector.py` - changepoint detection function
* `cru_changepoint_detector_wrapper.py` - wrapper to call changepoint detection function for a specified station code: requires CUSUM obs for the station generated by [glosat-homogenisation](https://github.com/patternizer/glosat-homogenisation)
* `cru_changepoint_detector_static.py` - stand-alone wrapper to calculate changepoints and adjustments for a given station directly from the LEK output dataframe
* `cru_changepoint_detector_runnable.py` - command-line runnable to calculate changepoints and adjustments for a given station directly from the LEK output dataframe (see call syntax below)

The first step is to clone the latest glosat-breakpoint-analysis code and step into the check out directory: 

    $ git clone https://github.com/patternizer/glosat-breakpoint-analysis.git
    $ cd glosat-breakpoint-analysis

### Usage

The code was tested locally in a Python 3.8.11 virtual environment.

    $ python linear_tree_regression.py
    $ python cru_changepoint_detector_wrapper.py
    $ python cru_changepoint_detector_static.py
    $ python cru_changepoint_detector_runnable.py 037401

You will need to install the LTR driver with pip install linear-tree. Check other python library dependencies in each code header.
The linear_tree_regression code takes as input the CSV station local expectation Kriging CUSUM timeseries output by the homogenisation code. Examples for testing in DATA/ and output breakpoints in decimal year format.
The static code has stationcode hardcoded and can be run for a specific station by changing the line defining the stationcode variable in the code. This code also has hardcoded documented change provided by metadata analysis performed by Emily Wallis.
The runnable code runs from the command line directly and should be the preferred option for most users.

## License

The code is distributed under terms and conditions of the [Open Government License](http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/).

## Contact information

* [Michael Taylor](michael.a.taylor@uea.ac.uk)



